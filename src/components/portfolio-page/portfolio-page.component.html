<main class="flex flex-col lg:flex-row overflow-hidden" style="height: 100vh; max-height: 100vh;">
  <!-- Left Pane (50% width on large screens, full width on mobile) -->
  <div class="w-full lg:w-1/2 flex flex-col lg:h-full overflow-hidden min-h-0">
    <!-- Top Section (20% height on large screens, auto on mobile) -->
    <div class="min-h-[200px] lg:h-[20%] flex flex-col p-4 sm:p-6">
      <!-- Navigation -->
      <div class="flex items-baseline gap-x-3 sm:gap-x-4 mb-4 flex-wrap">
        <h1 class="text-2xl sm:text-3xl font-bold tracking-tight text-gray-900">
          Portfolio
        </h1>
        <a routerLink="/transactions" class="text-xl sm:text-2xl font-medium text-gray-400 hover:text-gray-600 transition-colors">
          Transactions
        </a>
      </div>

      <!-- Total Portfolio Value -->
      @if (isLoading()) {
        <div class="flex-1">
          <div class="h-4 bg-gray-200 rounded w-40 mb-2 animate-pulse"></div>
          <div class="h-8 sm:h-10 bg-gray-200 rounded w-48 animate-pulse"></div>
        </div>
      } @else {
        <div class="flex-1">
          <h2 class="text-sm font-medium text-gray-500 mb-2">Total Portfolio Value</h2>
          <div class="flex items-baseline gap-x-2 sm:gap-x-3 flex-wrap mb-2">
            <p class="text-2xl sm:text-3xl font-bold tracking-tight text-gray-900">
              {{ totalValue() | currency:'EUR':'symbol':'1.2-2' }}
            </p>
            @if (dailyGainLoss() !== 0) {
              <p class="text-base sm:text-lg font-medium" [class]="dailyGainLoss() >= 0 ? 'text-green-600' : 'text-red-600'">
                {{ dailyGainLoss() > 0 ? '+' : '' }}{{ dailyGainLoss() | currency:'EUR':'symbol':'1.2-2' }} ({{ dailyGainLossPercentage() | percent:'1.2-2' }})
              </p>
            }
          </div>

          <!-- Insights Carousel -->
          @if (insights().length > 0) {
            <div class="mt-2 min-h-[40px] flex flex-col justify-center">
              @for (insight of insights(); track insight.message; let i = $index) {
                @if (i === currentInsightIndex()) {
                  <p class="text-center text-sm font-medium" [class]="getInsightSeverityClass(insight.severity)">
                    {{ insight.message }}
                  </p>
                }
              }

              @if (insights().length > 1) {
                <div class="flex justify-center gap-x-2 mt-2">
                  @for (insight of insights(); track $index; let i = $index) {
                    <button (click)="setCurrentInsight(i)" (click)="$event.stopPropagation()" [attr.aria-label]="'Go to insight ' + (i + 1)" class="w-2 h-2 rounded-full transition-colors" [class]="i === currentInsightIndex() ? 'bg-gray-800' : 'bg-gray-300 hover:bg-gray-400'">
                    </button>
                  }
                </div>
              }
            </div>
          } @else {
            <div class="mt-2 min-h-[40px] flex flex-col justify-center">
              <p class="text-center text-sm text-gray-500">
                No insights to be displayed at the moment
              </p>
            </div>
          }
        </div>
      }
    </div>

    <!-- Bottom Section (80% height on large screens, auto on mobile) - Placeholder for dashboards/metrics -->
    <div class="min-h-[300px] lg:flex-1 p-4 sm:p-6 overflow-y-auto min-h-0">
      @if (isLoading()) {
        <div class="space-y-4">
          <div class="h-32 bg-gray-100 rounded-lg animate-pulse"></div>
          <div class="h-32 bg-gray-100 rounded-lg animate-pulse"></div>
          <div class="h-32 bg-gray-100 rounded-lg animate-pulse"></div>
        </div>
      } @else if (error()) {
        <div class="flex items-center justify-center min-h-[300px]">
          <p class="text-gray-500">Error loading dashboard data</p>
        </div>
      } @else {
        <!-- Placeholder for future dashboards/metrics -->
        <div class="flex flex-col items-center justify-center min-h-[300px] lg:h-full text-gray-400">
          <svg class="w-16 h-16 sm:w-24 sm:h-24 mb-4 opacity-50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
          </svg>
          <p class="text-base sm:text-lg font-medium">Dashboard & Metrics</p>
          <p class="text-xs sm:text-sm mt-2">Coming soon...</p>
        </div>
      }
    </div>
  </div>

  <!-- Right Pane (50% width on large screens, full width on mobile) - Portfolio Positions -->
  <div class="w-full lg:w-1/2 p-4 sm:p-6" style="height: 100%; overflow-y: auto;">
    @if (isLoading()) {
      <app-portfolio-skeleton></app-portfolio-skeleton>
    } @else if (error() && portfolio().length === 0) {
      <app-error-state
        [title]="'Unable to load portfolio'"
        [message]="error() || 'We couldn\'t connect to Alfred. Please check your connection.'"
        (retry)="portfolioService.reload()">
      </app-error-state>
    } @else {
      <app-portfolio-list 
        [portfolio]="portfolio()"
        (update)="updateTransaction($event)"
        (delete)="deleteTransaction($event)">
      </app-portfolio-list>
    }
  </div>
</main>