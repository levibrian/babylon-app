<!-- Loading State -->
@if (loading()) {
  <div class="flex items-center gap-2 text-sm text-gray-400">
    <div class="w-4 h-4 border-2 border-gray-200 border-t-gray-400 rounded-full animate-spin"></div>
    <span>Loading...</span>
  </div>
}

<!-- Error State -->
@else if (error()) {
  <div class="text-sm text-gray-500">
    Unable to load recommendations
  </div>
}

<!-- Empty State -->
@else if (!hasActions()) {
  <div class="border border-gray-100 rounded-lg p-4">
    <div class="flex gap-3">
      <svg class="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <p class="text-sm text-gray-600">Portfolio is balanced. No actions needed.</p>
    </div>
  </div>
}

<!-- Action Carousel -->
@else if (currentAction(); as action) {
  <div class="w-full">
    <!-- Action Card -->
    <div 
      class="border border-gray-100 rounded-lg p-4 shadow-sm hover:shadow-md transition-all"
      [class]="action.actionType === 'Buy' ? 'bg-emerald-50/40' : 'bg-rose-50/40'">
      
      <!-- Icon + Content -->
      <div class="flex gap-3">
        <!-- Action Icon -->
        <div 
          class="flex items-center justify-center w-8 h-8 rounded-lg flex-shrink-0"
          [class]="getActionIconClass(action)">
          @if (action.actionType === 'Buy') {
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
          } @else {
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15" />
            </svg>
          }
        </div>

        <!-- Main Content -->
        <div class="flex-1 min-w-0">
          <!-- Header: Action + Ticker + Amount -->
          <div class="flex items-baseline justify-between gap-2">
            <div class="flex items-baseline gap-2">
              <span 
                class="text-xs font-semibold uppercase"
                [class]="getActionColorClass(action)">
                {{ action.actionType }}
              </span>
              <span class="font-bold text-gray-900">{{ action.ticker }}</span>
            </div>
            <span 
              class="font-mono font-semibold"
              [class]="getActionColorClass(action)">
              {{ action.amount | currency:'EUR':'symbol':'1.0-0' }}
            </span>
          </div>

          <!-- Reason -->
          <p class="text-sm text-gray-600 mt-1">{{ action.reason }}</p>

          <!-- Stats Row -->
          <div class="flex items-center gap-4 mt-3 text-xs text-gray-500">
            <!-- Allocation -->
            <span>
              {{ action.currentAllocationPercentage | number:'1.1-1' }}% â†’ {{ action.targetAllocationPercentage | number:'1.1-1' }}%
            </span>

            <!-- Timing -->
            @if (action.timingPercentile1Y !== null) {
              <span [class]="getTimingColorClass(action.timingPercentile1Y)">
                {{ getTimingLabel(action.timingPercentile1Y) }}
              </span>
            }

            <!-- P&L -->
            @if (action.unrealizedPnLPercentage !== null) {
              <span [class]="action.unrealizedPnLPercentage >= 0 ? 'text-emerald-600' : 'text-rose-600'">
                {{ action.unrealizedPnLPercentage >= 0 ? '+' : '' }}{{ action.unrealizedPnLPercentage | number:'1.1-1' }}%
              </span>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Dot Navigation -->
    @if (actionCount() > 1) {
      <div class="flex items-center justify-center gap-2 mt-3">
        @for (a of allActions(); track a.ticker + a.actionType; let i = $index) {
          <button 
            (click)="goToAction(i)"
            class="w-2 h-2 rounded-full transition-all duration-300"
            [class]="currentActionIndex() === i ? 'bg-gray-900 w-4' : 'bg-gray-300 hover:bg-gray-400'"
            [attr.aria-label]="'Go to action ' + (i + 1)"
            [attr.aria-current]="currentActionIndex() === i ? 'true' : 'false'">
          </button>
        }
      </div>
    }
  </div>
}
